import { Component, ViewEncapsulation, EventEmitter, Input, Output, } from "@angular/core";
import { create, supported } from "filepond";
import * as i0 from "@angular/core";
// We test if filepond is supported on the current client
const isSupported = supported();
// List of attributes for fallback input
const inputAttributes = [
    "id",
    "name",
    "class",
    "multiple",
    "required",
    "disabled",
    "capture",
    "accept",
];
// Methods not made available on the component
const filteredComponentMethods = [
    "setOptions",
    "on",
    "off",
    "onOnce",
    "appendTo",
    "insertAfter",
    "insertBefore",
    "isAttachedTo",
    "replaceElement",
    "restoreElement",
    "destroy",
];
const outputs = [
    "oninit",
    "onwarning",
    "onerror",
    "onactivatefile",
    "onaddfilestart",
    "onaddfileprogress",
    "onaddfile",
    "onprocessfilestart",
    "onprocessfileprogress",
    "onprocessfileabort",
    "onprocessfilerevert",
    "onprocessfile",
    "onprocessfiles",
    "onremovefile",
    "onpreparefile",
    "onupdatefiles",
];
// Component outline
export class FilePondComponent {
    constructor(root, zone) {
        this.options = {};
        // same as outputs array
        this.oninit = new EventEmitter();
        this.onwarning = new EventEmitter();
        this.onerror = new EventEmitter();
        this.onactivatefile = new EventEmitter();
        this.onaddfilestart = new EventEmitter();
        this.onaddfileprogress = new EventEmitter();
        this.onaddfile = new EventEmitter();
        this.onprocessfilestart = new EventEmitter();
        this.onprocessfileprogress = new EventEmitter();
        this.onprocessfileabort = new EventEmitter();
        this.onprocessfilerevert = new EventEmitter();
        this.onprocessfile = new EventEmitter();
        this.onprocessfiles = new EventEmitter();
        this.onremovefile = new EventEmitter();
        this.onpreparefile = new EventEmitter();
        this.onupdatefiles = new EventEmitter();
        this.pond = null;
        this.handleEvent = null;
        this.root = root;
        this.zone = zone;
    }
    ngAfterViewInit() {
        const input = this.root.nativeElement.querySelector("input");
        // transfer relevant attributes to input, this so we still have an input with the correct attributes should file pond not load
        const attributes = this.root.nativeElement.attributes;
        inputAttributes.forEach((name) => {
            const value = attributes[name]
                ? attributes[name].value
                : this.options[name];
            if (!value) {
                return;
            }
            input.setAttribute(name, value);
        });
        // no sufficient features supported in this browser
        if (!isSupported) {
            return;
        }
        // map FilePond events to Angular @outputs
        this.handleEvent = (e) => {
            const key = `on${e.type.split(":")[1]}`;
            // @ts-ignore
            this[key].emit({ ...e.detail });
        };
        outputs.forEach((event) => {
            this.root.nativeElement.addEventListener(`FilePond:${event.substring(2)}`, this.handleEvent);
        });
        // will block angular from listening to events inside the pond
        this.zone.runOutsideAngular(() => {
            // create instance
            this.pond = create(input, {
                // our options
                ...this.options,
                // our initial files
                files: this.files,
            });
        });
        // Copy instance method references to component instance
        this.pond &&
            Object.keys(this.pond)
                // remove unwanted methods
                .filter((key) => filteredComponentMethods.indexOf(key) === -1)
                // set method references from the component instance to the pond instance
                .forEach((key) => {
                // @ts-ignore
                this[key] = this.pond[key];
            });
    }
    ngOnChanges(changes) {
        // no need to handle first change
        if (changes["firstChange"])
            return;
        // no filepond instance available
        if (!this.pond) {
            return;
        }
        // use new options object as base ( or if not available, use current options )
        const options = changes["options"]
            ? changes["options"].currentValue
            : this.options;
        // see if file list has changed
        if (changes["files"] &&
            JSON.stringify(changes["files"].previousValue) !==
                JSON.stringify(changes["files"].currentValue)) {
            // file list has changed
            options.files = changes["files"].currentValue;
        }
        // set new options
        this.pond.setOptions(options);
    }
    ngOnDestroy() {
        if (!this.pond) {
            return;
        }
        outputs.forEach((event) => {
            this.root.nativeElement.removeEventListener(`FilePond:${event.substring(2)}`, this.handleEvent);
        });
        this.pond.destroy();
    }
}
FilePondComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.1", ngImport: i0, type: FilePondComponent, deps: [{ token: i0.ElementRef }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Component });
FilePondComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.1", type: FilePondComponent, selector: "file-pond", inputs: { options: "options", files: "files" }, outputs: { oninit: "oninit", onwarning: "onwarning", onerror: "onerror", onactivatefile: "onactivatefile", onaddfilestart: "onaddfilestart", onaddfileprogress: "onaddfileprogress", onaddfile: "onaddfile", onprocessfilestart: "onprocessfilestart", onprocessfileprogress: "onprocessfileprogress", onprocessfileabort: "onprocessfileabort", onprocessfilerevert: "onprocessfilerevert", onprocessfile: "onprocessfile", onprocessfiles: "onprocessfiles", onremovefile: "onremovefile", onpreparefile: "onpreparefile", onupdatefiles: "onupdatefiles" }, usesOnChanges: true, ngImport: i0, template: "<div class=\"filepond--wrapper\">\n  <input type=\"file\"/>\n</div>", styles: [""], encapsulation: i0.ViewEncapsulation.None });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.1", ngImport: i0, type: FilePondComponent, decorators: [{
            type: Component,
            args: [{ selector: "file-pond", encapsulation: ViewEncapsulation.None, template: "<div class=\"filepond--wrapper\">\n  <input type=\"file\"/>\n</div>" }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.NgZone }]; }, propDecorators: { options: [{
                type: Input
            }], files: [{
                type: Input
            }], oninit: [{
                type: Output
            }], onwarning: [{
                type: Output
            }], onerror: [{
                type: Output
            }], onactivatefile: [{
                type: Output
            }], onaddfilestart: [{
                type: Output
            }], onaddfileprogress: [{
                type: Output
            }], onaddfile: [{
                type: Output
            }], onprocessfilestart: [{
                type: Output
            }], onprocessfileprogress: [{
                type: Output
            }], onprocessfileabort: [{
                type: Output
            }], onprocessfilerevert: [{
                type: Output
            }], onprocessfile: [{
                type: Output
            }], onprocessfiles: [{
                type: Output
            }], onremovefile: [{
                type: Output
            }], onpreparefile: [{
                type: Output
            }], onupdatefiles: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWZpbGVwb25kLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1maWxlcG9uZC9zcmMvbGliL25neC1maWxlcG9uZC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtZmlsZXBvbmQvc3JjL2xpYi9uZ3gtZmlsZXBvbmQuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFHVCxpQkFBaUIsRUFDakIsWUFBWSxFQUVaLEtBQUssRUFDTCxNQUFNLEdBSVAsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQTZCLE1BQU0sVUFBVSxDQUFDOztBQUV4RSx5REFBeUQ7QUFDekQsTUFBTSxXQUFXLEdBQVksU0FBUyxFQUFFLENBQUM7QUFFekMsd0NBQXdDO0FBQ3hDLE1BQU0sZUFBZSxHQUFrQjtJQUNyQyxJQUFJO0lBQ0osTUFBTTtJQUNOLE9BQU87SUFDUCxVQUFVO0lBQ1YsVUFBVTtJQUNWLFVBQVU7SUFDVixTQUFTO0lBQ1QsUUFBUTtDQUNULENBQUM7QUFFRiw4Q0FBOEM7QUFDOUMsTUFBTSx3QkFBd0IsR0FBa0I7SUFDOUMsWUFBWTtJQUNaLElBQUk7SUFDSixLQUFLO0lBQ0wsUUFBUTtJQUNSLFVBQVU7SUFDVixhQUFhO0lBQ2IsY0FBYztJQUNkLGNBQWM7SUFDZCxnQkFBZ0I7SUFDaEIsZ0JBQWdCO0lBQ2hCLFNBQVM7Q0FDVixDQUFDO0FBRUYsTUFBTSxPQUFPLEdBQWtCO0lBQzdCLFFBQVE7SUFDUixXQUFXO0lBQ1gsU0FBUztJQUNULGdCQUFnQjtJQUNoQixnQkFBZ0I7SUFDaEIsbUJBQW1CO0lBQ25CLFdBQVc7SUFDWCxvQkFBb0I7SUFDcEIsdUJBQXVCO0lBQ3ZCLG9CQUFvQjtJQUNwQixxQkFBcUI7SUFDckIsZUFBZTtJQUNmLGdCQUFnQjtJQUNoQixjQUFj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QkFBbEIsTUFBTTtnQkFDRyxrQkFBa0I7c0JBQTNCLE1BQU07Z0JBQ0cscUJBQXFCO3NCQUE5QixNQUFNO2dCQUNHLGtCQUFrQjtzQkFBM0IsTUFBTTtnQkFDRyxtQkFBbUI7c0JBQTVCLE1BQU07Z0JBQ0csYUFBYTtzQkFBdEIsTUFBTTtnQkFDRyxjQUFjO3NCQUF2QixNQUFNO2dCQUNHLFlBQVk7c0JBQXJCLE1BQU07Z0JBQ0csYUFBYTtzQkFBdEIsTUFBTTtnQkFDRyxhQUFhO3NCQUF0QixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBTaW1wbGVDaGFuZ2VzLFxuICBWaWV3RW5jYXBzdWxhdGlvbixcbiAgRXZlbnRFbWl0dGVyLFxuICBOZ1pvbmUsXG4gIElucHV0LFxuICBPdXRwdXQsXG4gIEFmdGVyVmlld0luaXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25EZXN0cm95LFxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuXG5pbXBvcnQgeyBjcmVhdGUsIHN1cHBvcnRlZCwgRmlsZVBvbmQsIEZpbGVQb25kT3B0aW9ucyB9IGZyb20gXCJmaWxlcG9uZFwiO1xuXG4vLyBXZSB0ZXN0IGlmIGZpbGVwb25kIGlzIHN1cHBvcnRlZCBvbiB0aGUgY3VycmVudCBjbGllbnRcbmNvbnN0IGlzU3VwcG9ydGVkOiBCb29sZWFuID0gc3VwcG9ydGVkKCk7XG5cbi8vIExpc3Qgb2YgYXR0cmlidXRlcyBmb3IgZmFsbGJhY2sgaW5wdXRcbmNvbnN0IGlucHV0QXR0cmlidXRlczogQXJyYXk8c3RyaW5nPiA9IFtcbiAgXCJpZFwiLFxuICBcIm5hbWVcIixcbiAgXCJjbGFzc1wiLFxuICBcIm11bHRpcGxlXCIsXG4gIFwicmVxdWlyZWRcIixcbiAgXCJkaXNhYmxlZFwiLFxuICBcImNhcHR1cmVcIixcbiAgXCJhY2NlcHRcIixcbl07XG5cbi8vIE1ldGhvZHMgbm90IG1hZGUgYXZhaWxhYmxlIG9uIHRoZSBjb21wb25lbnRcbmNvbnN0IGZpbHRlcmVkQ29tcG9uZW50TWV0aG9kczogQXJyYXk8c3RyaW5nPiA9IFtcbiAgXCJzZXRPcHRpb25zXCIsXG4gIFwib25cIixcbiAgXCJvZmZcIixcbiAgXCJvbk9uY2VcIixcbiAgXCJhcHBlbmRUb1wiLFxuICBcImluc2VydEFmdGVyXCIsXG4gIFwiaW5zZXJ0QmVmb3JlXCIsXG4gIFwiaXNBdHRhY2hlZFRvXCIsXG4gIFwicmVwbGFjZUVsZW1lbnRcIixcbiAgXCJyZXN0b3JlRWxlbWVudFwiLFxuICBcImRlc3Ryb3lcIixcbl07XG5cbmNvbnN0IG91dHB1dHM6IEFycmF5PHN0cmluZz4gPSBbXG4gIFwib25pbml0XCIsXG4gIFwib253YXJuaW5nXCIsXG4gIFwib25lcnJvclwiLFxuICBcIm9uYWN0aXZhdGVmaWxlXCIsXG4gIFwib25hZGRmaWxlc3RhcnRcIixcbiAgXCJvbmFkZGZpbGVwcm9ncmVzc1wiLFxuICBcIm9uYWRkZmlsZVwiLFxuICBcIm9ucHJvY2Vzc2ZpbGVzdGFydFwiLFxuICBcIm9ucHJvY2Vzc2ZpbGVwcm9ncmVzc1wiLFxuICBcIm9ucHJvY2Vzc2ZpbGVhYm9ydFwiLFxuICBcIm9ucHJvY2Vzc2ZpbGVyZXZlcnRcIixcbiAgXCJvbnByb2Nlc3NmaWxlXCIsXG4gIFwib25wcm9jZXNzZmlsZXNcIixcbiAgXCJvbnJlbW92ZWZpbGVcIixcbiAgXCJvbnByZXBhcmVmaWxlXCIsXG4gIFwib251cGRhdGVmaWxlc1wiLFxuXTtcblxuLy8gQ29tcG9uZW50IG91dGxpbmVcbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogXCJmaWxlLXBvbmRcIixcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbiAgdGVtcGxhdGVVcmw6IFwiLi9uZ3gtZmlsZXBvbmQuY29tcG9uZW50Lmh0bWxcIixcbiAgc3R5bGVVcmxzOiBbXCIuL25neC1maWxlcG9uZC5jb21wb25lbnQuY3NzXCJdLFxufSlcbmV4cG9ydCBjbGFzcyBGaWxlUG9uZENvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcbiAgQElucHV0KClcbiAgb3B0aW9uczogRmlsZVBvbmRPcHRpb25zIHwgYW55ID0ge307XG5cbiAgQElucHV0KClcbiAgZmlsZXM6IEZpbGVQb25kT3B0aW9uc1tcImZpbGVzXCJdO1xuXG4gIC8vIHNhbWUgYXMgb3V0cHV0cyBhcnJheVxuICBAT3V0cHV0KCkgb25pbml0ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoKSBvbndhcm5pbmcgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgpIG9uZXJyb3IgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgpIG9uYWN0aXZhdGVmaWxlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoKSBvbmFkZGZpbGVzdGFydCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgb25hZGRmaWxlcHJvZ3Jlc3MgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgpIG9uYWRkZmlsZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgb25wcm9jZXNzZmlsZXN0YXJ0ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoKSBvbnByb2Nlc3NmaWxlcHJvZ3Jlc3MgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgpIG9ucHJvY2Vzc2ZpbGVhYm9ydCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgb25wcm9jZXNzZmlsZXJldmVydCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgb25wcm9jZXNzZmlsZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgb25wcm9jZXNzZmlsZXMgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgpIG9ucmVtb3ZlZmlsZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgb25wcmVwYXJlZmlsZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgb251cGRhdGVmaWxlcyA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIHByaXZhdGUgcm9vdDogRWxlbWVudFJlZjtcbiAgcHJpdmF0ZSB6b25lOiBOZ1pvbmU7XG4gIHByaXZhdGUgcG9uZDogRmlsZVBvbmQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBoYW5kbGVFdmVudDogRnVuY3Rpb24gfCBudWxsID0gbnVsbDtcblxuICBjb25zdHJ1Y3Rvcihyb290OiBFbGVtZW50UmVmLCB6b25lOiBOZ1pvbmUpIHtcbiAgICB0aGlzLnJvb3QgPSByb290O1xuICAgIHRoaXMuem9uZSA9IHpvbmU7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgY29uc3QgaW5wdXQgPSB0aGlzLnJvb3QubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRcIik7XG5cbiAgICAvLyB0cmFuc2ZlciByZWxldmFudCBhdHRyaWJ1dGVzIHRvIGlucHV0LCB0aGlzIHNvIHdlIHN0aWxsIGhhdmUgYW4gaW5wdXQgd2l0aCB0aGUgY29ycmVjdCBhdHRyaWJ1dGVzIHNob3VsZCBmaWxlIHBvbmQgbm90IGxvYWRcbiAgICBjb25zdCBhdHRyaWJ1dGVzID0gdGhpcy5yb290Lm5hdGl2ZUVsZW1lbnQuYXR0cmlidXRlcztcbiAgICBpbnB1dEF0dHJpYnV0ZXMuZm9yRWFjaCgobmFtZSkgPT4ge1xuICAgICAgY29uc3QgdmFsdWUgPSBhdHRyaWJ1dGVzW25hbWVdXG4gICAgICAgID8gYXR0cmlidXRlc1tuYW1lXS52YWx1ZVxuICAgICAgICA6IHRoaXMub3B0aW9uc1tuYW1lXTtcbiAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKTtcbiAgICB9KTtcblxuICAgIC8vIG5vIHN1ZmZpY2llbnQgZmVhdHVyZXMgc3VwcG9ydGVkIGluIHRoaXMgYnJvd3NlclxuICAgIGlmICghaXNTdXBwb3J0ZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBtYXAgRmlsZVBvbmQgZXZlbnRzIHRvIEFuZ3VsYXIgQG91dHB1dHNcbiAgICB0aGlzLmhhbmRsZUV2ZW50ID0gKGU6IEV2ZW50KSA9PiB7XG4gICAgICBjb25zdCBrZXkgPSBgb24ke2UudHlwZS5zcGxpdChcIjpcIilbMV19YDtcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIHRoaXNba2V5XS5lbWl0KHsgLi4uZS5kZXRhaWwgfSk7XG4gICAgfTtcbiAgICBvdXRwdXRzLmZvckVhY2goKGV2ZW50KSA9PiB7XG4gICAgICB0aGlzLnJvb3QubmF0aXZlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgICBgRmlsZVBvbmQ6JHtldmVudC5zdWJzdHJpbmcoMil9YCxcbiAgICAgICAgdGhpcy5oYW5kbGVFdmVudFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIC8vIHdpbGwgYmxvY2sgYW5ndWxhciBmcm9tIGxpc3RlbmluZyB0byBldmVudHMgaW5zaWRlIHRoZSBwb25kXG4gICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIC8vIGNyZWF0ZSBpbnN0YW5jZVxuICAgICAgdGhpcy5wb25kID0gY3JlYXRlKGlucHV0LCB7XG4gICAgICAgIC8vIG91ciBvcHRpb25zXG4gICAgICAgIC4uLnRoaXMub3B0aW9ucyxcblxuICAgICAgICAvLyBvdXIgaW5pdGlhbCBmaWxlc1xuICAgICAgICBmaWxlczogdGhpcy5maWxlcyxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gQ29weSBpbnN0YW5jZSBtZXRob2QgcmVmZXJlbmNlcyB0byBjb21wb25lbnQgaW5zdGFuY2VcbiAgICB0aGlzLnBvbmQgJiZcbiAgICAgIE9iamVjdC5rZXlzKHRoaXMucG9uZClcblxuICAgICAgICAvLyByZW1vdmUgdW53YW50ZWQgbWV0aG9kc1xuICAgICAgICAuZmlsdGVyKChrZXkpID0+IGZpbHRlcmVkQ29tcG9uZW50TWV0aG9kcy5pbmRleE9mKGtleSkgPT09IC0xKVxuXG4gICAgICAgIC8vIHNldCBtZXRob2QgcmVmZXJlbmNlcyBmcm9tIHRoZSBjb21wb25lbnQgaW5zdGFuY2UgdG8gdGhlIHBvbmQgaW5zdGFuY2VcbiAgICAgICAgLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICB0aGlzW2tleV0gPSB0aGlzLnBvbmRba2V5XTtcbiAgICAgICAgfSk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgLy8gbm8gbmVlZCB0byBoYW5kbGUgZmlyc3QgY2hhbmdlXG4gICAgaWYgKGNoYW5nZXNbXCJmaXJzdENoYW5nZVwiXSkgcmV0dXJuO1xuXG4gICAgLy8gbm8gZmlsZXBvbmQgaW5zdGFuY2UgYXZhaWxhYmxlXG4gICAgaWYgKCF0aGlzLnBvbmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyB1c2UgbmV3IG9wdGlvbnMgb2JqZWN0IGFzIGJhc2UgKCBvciBpZiBub3QgYXZhaWxhYmxlLCB1c2UgY3VycmVudCBvcHRpb25zIClcbiAgICBjb25zdCBvcHRpb25zID0gY2hhbmdlc1tcIm9wdGlvbnNcIl1cbiAgICAgID8gY2hhbmdlc1tcIm9wdGlvbnNcIl0uY3VycmVudFZhbHVlXG4gICAgICA6IHRoaXMub3B0aW9ucztcblxuICAgIC8vIHNlZSBpZiBmaWxlIGxpc3QgaGFzIGNoYW5nZWRcbiAgICBpZiAoXG4gICAgICBjaGFuZ2VzW1wiZmlsZXNcIl0gJiZcbiAgICAgIEpTT04uc3RyaW5naWZ5KGNoYW5nZXNbXCJmaWxlc1wiXS5wcmV2aW91c1ZhbHVlKSAhPT1cbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoY2hhbmdlc1tcImZpbGVzXCJdLmN1cnJlbnRWYWx1ZSlcbiAgICApIHtcbiAgICAgIC8vIGZpbGUgbGlzdCBoYXMgY2hhbmdlZFxuICAgICAgb3B0aW9ucy5maWxlcyA9IGNoYW5nZXNbXCJmaWxlc1wiXS5jdXJyZW50VmFsdWU7XG4gICAgfVxuXG4gICAgLy8gc2V0IG5ldyBvcHRpb25zXG4gICAgdGhpcy5wb25kLnNldE9wdGlvbnMob3B0aW9ucyk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICBpZiAoIXRoaXMucG9uZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIG91dHB1dHMuZm9yRWFjaCgoZXZlbnQpID0+IHtcbiAgICAgIHRoaXMucm9vdC5uYXRpdmVFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXG4gICAgICAgIGBGaWxlUG9uZDoke2V2ZW50LnN1YnN0cmluZygyKX1gLFxuICAgICAgICB0aGlzLmhhbmRsZUV2ZW50XG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgdGhpcy5wb25kLmRlc3Ryb3koKTtcbiAgfVxufVxuIiwiPGRpdiBjbGFzcz1cImZpbGVwb25kLS13cmFwcGVyXCI+XG4gIDxpbnB1dCB0eXBlPVwiZmlsZVwiLz5cbjwvZGl2PiJdfQ==