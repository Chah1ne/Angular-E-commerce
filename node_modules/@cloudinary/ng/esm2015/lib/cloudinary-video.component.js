import { Component, Input, ElementRef, EventEmitter, Output } from '@angular/core';
import { CloudinaryVideo } from '@cloudinary/url-gen';
import { cancelCurrentlyRunningPlugins, HtmlVideoLayer } from '@cloudinary/html';
import * as i0 from "@angular/core";
/**
 * @memberOf AngularSDK
 * @type {Component}
 * @description The Cloudinary video component.
 * @prop {CloudinaryVideo} transformation Generated by @cloudinary/url-gen
 * @prop {VideoPoster} transformation Generated by @cloudinary/url-gen
 * @prop {Plugins} plugins Advanced image component plugins lazyload()
 * @prop videoAttributes Optional attributes include controls, loop, muted, poster, preload, autoplay
 * @prop videoEvents Optional video events include play, loadstart, playing, error, ended
 * @prop {VideoSources} sources Optional sources to generate
 * @example
 *  <caption>
 *  Using custom defined resources.
 * </caption>
 *   vid = new CloudinaryVideo('dog', {cloudName: 'demo'});
 *   sources = [
 {
        type: 'mp4',
        codecs: ['vp8', 'vorbis'],
        transcode: videoCodec(auto())
},
 {
        type: 'webm',
        codecs: ['avc1.4D401E', 'mp4a.40.2'],
         transcode: videoCodec(auto())
      }];
 *
 * <advanced-video [cldvid]="vid" [sources]="sources" controls></advanced-video>
 */
export class CloudinaryVideoComponent {
    constructor(el) {
        this.el = el;
        // Event emitters
        this.play = new EventEmitter();
        this.loadstart = new EventEmitter();
        this.playing = new EventEmitter();
        this.error = new EventEmitter();
        this.ended = new EventEmitter();
        // supported video attributes
        this.controls = this.el.nativeElement.attributes.controls;
        this.loop = this.el.nativeElement.attributes.loop;
        this.muted = this.el.nativeElement.attributes.muted;
        this.preload = this.el.nativeElement.attributes.preload;
        this.autoPlay = this.el.nativeElement.attributes.autoplay;
        this.playsInline = this.el.nativeElement.attributes.playsInline;
    }
    /**
     * On init creates a new HTMLVideoLayer instance and initializes with ref to video element,
     * user generated cloudinaryVideo and the plugins to be used.
     */
    ngOnInit() {
        this.htmlVideoLayerInstance = new HtmlVideoLayer(this.el.nativeElement.children[0], this.cldVid, this.sources, this.plugins, this.getVideoAttributes(), this.cldPoster);
        // check if video should be muted. We need to take care of this here since Angular has a bug with binding the muted
        // attribute
        if (this.muted) {
            this.el.nativeElement.children[0].muted = true;
        }
        // attach ref to innerRef input
        this.attachRef();
    }
    /**
     * On update, we cancel running plugins and update the video instance if the src
     * was changed.
     */
    ngOnChanges() {
        if (this.htmlVideoLayerInstance) {
            cancelCurrentlyRunningPlugins(this.htmlVideoLayerInstance.htmlPluginState);
            this.htmlVideoLayerInstance.update(this.cldVid, this.sources, this.plugins, this.getVideoAttributes(), this.cldPoster);
        }
    }
    /**
     * On destroy, we cancel the currently running plugins.
     */
    ngOnDestroy() {
        // Safely cancel running events on destroy
        cancelCurrentlyRunningPlugins(this.htmlVideoLayerInstance.htmlPluginState);
    }
    /**
     * Returns video attributes.
     */
    getVideoAttributes() {
        return {
            controls: this.controls,
            loop: this.loop,
            muted: this.muted,
            poster: this.poster,
            preload: this.preload,
            autoplay: this.autoPlay,
            playsinline: this.playsInline
        };
    }
    emitPlayEvent() {
        this.play.emit();
    }
    emitLoadstartEvent() {
        this.loadstart.emit();
    }
    emitPlayingEvent() {
        this.playing.emit();
    }
    emitErrorEvent() {
        this.error.emit();
    }
    emitEndedEvent() {
        this.ended.emit();
    }
    /**
     * Attach both this.videoRef and props.innerRef as ref to the given element.
     */
    attachRef() {
        if (this.innerRef) {
            this.innerRef.nativeElement = this.el.nativeElement.children[0];
        }
    }
}
CloudinaryVideoComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: CloudinaryVideoComponent, deps: [{ token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component });
CloudinaryVideoComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.17", type: CloudinaryVideoComponent, selector: "advanced-video", inputs: { cldVid: "cldVid", cldPoster: "cldPoster", sources: "sources", plugins: "plugins", poster: "poster", innerRef: "innerRef" }, outputs: { play: "play", loadstart: "loadstart", playing: "playing", error: "error", ended: "ended" }, usesOnChanges: true, ngImport: i0, template: `<video (play)="emitPlayEvent()"
                    (loadstart)="emitLoadstartEvent()"
                    (playing)="emitPlayingEvent()"
                    (error)="emitErrorEvent"
                    (ended)="emitEndedEvent">
            </video>`, isInline: true });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: CloudinaryVideoComponent, decorators: [{
            type: Component,
            args: [{
                    // tslint:disable-next-line:component-selector
                    selector: 'advanced-video',
                    template: `<video (play)="emitPlayEvent()"
                    (loadstart)="emitLoadstartEvent()"
                    (playing)="emitPlayingEvent()"
                    (error)="emitErrorEvent"
                    (ended)="emitEndedEvent">
            </video>`,
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }]; }, propDecorators: { cldVid: [{
                type: Input,
                args: ['cldVid']
            }], cldPoster: [{
                type: Input,
                args: ['cldPoster']
            }], sources: [{
                type: Input,
                args: ['sources']
            }], plugins: [{
                type: Input,
                args: ['plugins']
            }], poster: [{
                type: Input,
                args: ['poster']
            }], innerRef: [{
                type: Input,
                args: ['innerRef']
            }], play: [{
                type: Output
            }], loadstart: [{
                type: Output
            }], playing: [{
                type: Output
            }], error: [{
                type: Output
            }], ended: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xvdWRpbmFyeS12aWRlby5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL2Nsb3VkaW5hcnktdmlkZW8uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQVUsS0FBSyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUF1QixNQUFNLGVBQWUsQ0FBQztBQUMvRyxPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0scUJBQXFCLENBQUM7QUFFcEQsT0FBTyxFQUNMLDZCQUE2QixFQUM3QixjQUFjLEVBSWYsTUFBTSxrQkFBa0IsQ0FBQzs7QUFHMUI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0E0Qkc7QUFXSCxNQUFNLE9BQU8sd0JBQXdCO0lBQ25DLFlBQW9CLEVBQWM7UUFBZCxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBU2xDLGlCQUFpQjtRQUNQLFNBQUksR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUM3QyxjQUFTLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7UUFDbEQsWUFBTyxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2hELFVBQUssR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUM5QyxVQUFLLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7UUFFeEQsNkJBQTZCO1FBQzdCLGFBQVEsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDO1FBQ3JELFNBQUksR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDO1FBQzdDLFVBQUssR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDO1FBQy9DLFlBQU8sR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMs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QUUsZ0JBQWdCO29CQUMxQixRQUFRLEVBQUU7Ozs7O3FCQUtTO2lCQUNwQjtpR0FJa0IsTUFBTTtzQkFBdEIsS0FBSzt1QkFBQyxRQUFRO2dCQUNLLFNBQVM7c0JBQTVCLEtBQUs7dUJBQUMsV0FBVztnQkFDQSxPQUFPO3NCQUF4QixLQUFLO3VCQUFDLFNBQVM7Z0JBQ0UsT0FBTztzQkFBeEIsS0FBSzt1QkFBQyxTQUFTO2dCQUNDLE1BQU07c0JBQXRCLEtBQUs7dUJBQUMsUUFBUTtnQkFDSSxRQUFRO3NCQUExQixLQUFLO3VCQUFDLFVBQVU7Z0JBR1AsSUFBSTtzQkFBYixNQUFNO2dCQUNHLFNBQVM7c0JBQWxCLE1BQU07Z0JBQ0csT0FBTztzQkFBaEIsTUFBTTtnQkFDRyxLQUFLO3NCQUFkLE1BQU07Z0JBQ0csS0FBSztzQkFBZCxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBPbkNoYW5nZXMsIE9uRGVzdHJveX0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0Nsb3VkaW5hcnlWaWRlb30gZnJvbSAnQGNsb3VkaW5hcnkvdXJsLWdlbic7XG5cbmltcG9ydCB7XG4gIGNhbmNlbEN1cnJlbnRseVJ1bm5pbmdQbHVnaW5zLFxuICBIdG1sVmlkZW9MYXllcixcbiAgUGx1Z2lucyxcbiAgVmlkZW9Qb3N0ZXIsXG4gIFZpZGVvU291cmNlc1xufSBmcm9tICdAY2xvdWRpbmFyeS9odG1sJztcblxuXG4vKipcbiAqIEBtZW1iZXJPZiBBbmd1bGFyU0RLXG4gKiBAdHlwZSB7Q29tcG9uZW50fVxuICogQGRlc2NyaXB0aW9uIFRoZSBDbG91ZGluYXJ5IHZpZGVvIGNvbXBvbmVudC5cbiAqIEBwcm9wIHtDbG91ZGluYXJ5VmlkZW99IHRyYW5zZm9ybWF0aW9uIEdlbmVyYXRlZCBieSBAY2xvdWRpbmFyeS91cmwtZ2VuXG4gKiBAcHJvcCB7VmlkZW9Qb3N0ZXJ9IHRyYW5zZm9ybWF0aW9uIEdlbmVyYXRlZCBieSBAY2xvdWRpbmFyeS91cmwtZ2VuXG4gKiBAcHJvcCB7UGx1Z2luc30gcGx1Z2lucyBBZHZhbmNlZCBpbWFnZSBjb21wb25lbnQgcGx1Z2lucyBsYXp5bG9hZCgpXG4gKiBAcHJvcCB2aWRlb0F0dHJpYnV0ZXMgT3B0aW9uYWwgYXR0cmlidXRlcyBpbmNsdWRlIGNvbnRyb2xzLCBsb29wLCBtdXRlZCwgcG9zdGVyLCBwcmVsb2FkLCBhdXRvcGxheVxuICogQHByb3AgdmlkZW9FdmVudHMgT3B0aW9uYWwgdmlkZW8gZXZlbnRzIGluY2x1ZGUgcGxheSwgbG9hZHN0YXJ0LCBwbGF5aW5nLCBlcnJvciwgZW5kZWRcbiAqIEBwcm9wIHtWaWRlb1NvdXJjZXN9IHNvdXJjZXMgT3B0aW9uYWwgc291cmNlcyB0byBnZW5lcmF0ZVxuICogQGV4YW1wbGVcbiAqICA8Y2FwdGlvbj5cbiAqICBVc2luZyBjdXN0b20gZGVmaW5lZCByZXNvdXJjZXMuXG4gKiA8L2NhcHRpb24+XG4gKiAgIHZpZCA9IG5ldyBDbG91ZGluYXJ5VmlkZW8oJ2RvZycsIHtjbG91ZE5hbWU6ICdkZW1vJ30pO1xuICogICBzb3VyY2VzID0gW1xuIHtcbiAgICAgICAgdHlwZTogJ21wNCcsXG4gICAgICAgIGNvZGVjczogWyd2cDgnLCAndm9yYmlzJ10sXG4gICAgICAgIHRyYW5zY29kZTogdmlkZW9Db2RlYyhhdXRvKCkpXG59LFxuIHtcbiAgICAgICAgdHlwZTogJ3dlYm0nLFxuICAgICAgICBjb2RlY3M6IFsnYXZjMS40RDQwMUUnLCAnbXA0YS40MC4yJ10sXG4gICAgICAgICB0cmFuc2NvZGU6IHZpZGVvQ29kZWMoYXV0bygpKVxuICAgICAgfV07XG4gKlxuICogPGFkdmFuY2VkLXZpZGVvIFtjbGR2aWRdPVwidmlkXCIgW3NvdXJjZXNdPVwic291cmNlc1wiIGNvbnRyb2xzPjwvYWR2YW5jZWQtdmlkZW8+XG4gKi9cbkBDb21wb25lbnQoe1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Y29tcG9uZW50LXNlbGVjdG9yXG4gIHNlbGVjdG9yOiAnYWR2YW5jZWQtdmlkZW8nLFxuICB0ZW1wbGF0ZTogYDx2aWRlbyAocGxheSk9XCJlbWl0UGxheUV2ZW50KClcIlxuICAgICAgICAgICAgICAgICAgICAobG9hZHN0YXJ0KT1cImVtaXRMb2Fkc3RhcnRFdmVudCgpXCJcbiAgICAgICAgICAgICAgICAgICAgKHBsYXlpbmcpPVwiZW1pdFBsYXlpbmdFdmVudCgpXCJcbiAgICAgICAgICAgICAgICAgICAgKGVycm9yKT1cImVtaXRFcnJvckV2ZW50XCJcbiAgICAgICAgICAgICAgICAgICAgKGVuZGVkKT1cImVtaXRFbmRlZEV2ZW50XCI+XG4gICAgICAgICAgICA8L3ZpZGVvPmAsXG59KVxuZXhwb3J0IGNsYXNzIENsb3VkaW5hcnlWaWRlb0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsOiBFbGVtZW50UmVmKSB7IH1cblxuICBASW5wdXQoJ2NsZFZpZCcpIGNsZFZpZDogQ2xvdWRpbmFyeVZpZGVvO1xuICBASW5wdXQoJ2NsZFBvc3RlcicpIGNsZFBvc3RlcjogVmlkZW9Qb3N0ZXI7XG4gIEBJbnB1dCgnc291cmNlcycpIHNvdXJjZXM6IFZpZGVvU291cmNlcztcbiAgQElucHV0KCdwbHVnaW5zJykgcGx1Z2luczogUGx1Z2lucztcbiAgQElucHV0KCdwb3N0ZXInKSBwb3N0ZXI6IHN0cmluZztcbiAgQElucHV0KCdpbm5lclJlZicpIGlubmVyUmVmOiBFbGVtZW50UmVmO1xuXG4gIC8vIEV2ZW50IGVtaXR0ZXJzXG4gIEBPdXRwdXQoKSBwbGF5OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIGxvYWRzdGFydDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSBwbGF5aW5nOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIGVycm9yOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIGVuZGVkOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAvLyBzdXBwb3J0ZWQgdmlkZW8gYXR0cmlidXRlc1xuICBjb250cm9scyA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5hdHRyaWJ1dGVzLmNvbnRyb2xzO1xuICBsb29wID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LmF0dHJpYnV0ZXMubG9vcDtcbiAgbXV0ZWQgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuYXR0cmlidXRlcy5tdXRlZDtcbiAgcHJlbG9hZCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5hdHRyaWJ1dGVzLnByZWxvYWQ7XG4gIGF1dG9QbGF5ID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LmF0dHJpYnV0ZXMuYXV0b3BsYXk7XG4gIHBsYXlzSW5saW5lID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LmF0dHJpYnV0ZXMucGxheXNJbmxpbmU7XG5cbiAgcHJpdmF0ZSBodG1sVmlkZW9MYXllckluc3RhbmNlOiBIdG1sVmlkZW9MYXllcjtcblxuICAvKipcbiAgICogT24gaW5pdCBjcmVhdGVzIGEgbmV3IEhUTUxWaWRlb0xheWVyIGluc3RhbmNlIGFuZCBpbml0aWFsaXplcyB3aXRoIHJlZiB0byB2aWRlbyBlbGVtZW50LFxuICAgKiB1c2VyIGdlbmVyYXRlZCBjbG91ZGluYXJ5VmlkZW8gYW5kIHRoZSBwbHVnaW5zIHRvIGJlIHVzZWQuXG4gICAqL1xuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmh0bWxWaWRlb0xheWVySW5zdGFuY2UgPSBuZXcgSHRtbFZpZGVvTGF5ZXIoXG4gICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bMF0sXG4gICAgICB0aGlzLmNsZFZpZCxcbiAgICAgIHRoaXMuc291cmNlcyxcbiAgICAgIHRoaXMucGx1Z2lucyxcbiAgICAgIHRoaXMuZ2V0VmlkZW9BdHRyaWJ1dGVzKCksXG4gICAgICB0aGlzLmNsZFBvc3RlclxuICAgICAgKTtcblxuICAgIC8vIGNoZWNrIGlmIHZpZGVvIHNob3VsZCBiZSBtdXRlZC4gV2UgbmVlZCB0byB0YWtlIGNhcmUgb2YgdGhpcyBoZXJlIHNpbmNlIEFuZ3VsYXIgaGFzIGEgYnVnIHdpdGggYmluZGluZyB0aGUgbXV0ZWRcbiAgICAvLyBhdHRyaWJ1dGVcbiAgICBpZiAodGhpcy5tdXRlZCkge1xuICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdLm11dGVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBhdHRhY2ggcmVmIHRvIGlubmVyUmVmIGlucHV0XG4gICAgdGhpcy5hdHRhY2hSZWYoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPbiB1cGRhdGUsIHdlIGNhbmNlbCBydW5uaW5nIHBsdWdpbnMgYW5kIHVwZGF0ZSB0aGUgdmlkZW8gaW5zdGFuY2UgaWYgdGhlIHNyY1xuICAgKiB3YXMgY2hhbmdlZC5cbiAgICovXG4gIG5nT25DaGFuZ2VzKCkge1xuICAgIGlmICh0aGlzLmh0bWxWaWRlb0xheWVySW5zdGFuY2UpIHtcbiAgICAgIGNhbmNlbEN1cnJlbnRseVJ1bm5pbmdQbHVnaW5zKHRoaXMuaHRtbFZpZGVvTGF5ZXJJbnN0YW5jZS5odG1sUGx1Z2luU3RhdGUpO1xuICAgICAgdGhpcy5odG1sVmlkZW9MYXllckluc3RhbmNlLnVwZGF0ZSh0aGlzLmNsZFZpZCwgdGhpcy5zb3VyY2VzLCB0aGlzLnBsdWdpbnMsIHRoaXMuZ2V0VmlkZW9BdHRyaWJ1dGVzKCksIHRoaXMuY2xkUG9zdGVyKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogT24gZGVzdHJveSwgd2UgY2FuY2VsIHRoZSBjdXJyZW50bHkgcnVubmluZyBwbHVnaW5zLlxuICAgKi9cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgLy8gU2FmZWx5IGNhbmNlbCBydW5uaW5nIGV2ZW50cyBvbiBkZXN0cm95XG4gICAgY2FuY2VsQ3VycmVudGx5UnVubmluZ1BsdWdpbnModGhpcy5odG1sVmlkZW9MYXllckluc3RhbmNlLmh0bWxQbHVnaW5TdGF0ZSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB2aWRlbyBhdHRyaWJ1dGVzLlxuICAgKi9cbiAgZ2V0VmlkZW9BdHRyaWJ1dGVzKCkge1xuICAgIHJldHVybiB7XG4gICAgICBjb250cm9sczogdGhpcy5jb250cm9scyxcbiAgICAgIGxvb3A6IHRoaXMubG9vcCxcbiAgICAgIG11dGVkOiB0aGlzLm11dGVkLFxuICAgICAgcG9zdGVyOiB0aGlzLnBvc3RlcixcbiAgICAgIHByZWxvYWQ6IHRoaXMucHJlbG9hZCxcbiAgICAgIGF1dG9wbGF5OiB0aGlzLmF1dG9QbGF5LFxuICAgICAgcGxheXNpbmxpbmU6IHRoaXMucGxheXNJbmxpbmVcbiAgICB9O1xuICB9XG5cbiAgZW1pdFBsYXlFdmVudCgpIHtcbiAgICB0aGlzLnBsYXkuZW1pdCgpO1xuICB9XG5cbiAgZW1pdExvYWRzdGFydEV2ZW50KCkge1xuICAgIHRoaXMubG9hZHN0YXJ0LmVtaXQoKTtcbiAgfVxuXG4gIGVtaXRQbGF5aW5nRXZlbnQoKSB7XG4gICAgdGhpcy5wbGF5aW5nLmVtaXQoKTtcbiAgfVxuXG4gIGVtaXRFcnJvckV2ZW50KCkge1xuICAgIHRoaXMuZXJyb3IuZW1pdCgpO1xuICB9XG5cbiAgZW1pdEVuZGVkRXZlbnQoKSB7XG4gICAgdGhpcy5lbmRlZC5lbWl0KCk7XG4gIH1cblxuICAvKipcbiAgICogQXR0YWNoIGJvdGggdGhpcy52aWRlb1JlZiBhbmQgcHJvcHMuaW5uZXJSZWYgYXMgcmVmIHRvIHRoZSBnaXZlbiBlbGVtZW50LlxuICAgKi9cbiAgYXR0YWNoUmVmKCkge1xuICAgIGlmICh0aGlzLmlubmVyUmVmKSB7XG4gICAgICB0aGlzLmlubmVyUmVmLm5hdGl2ZUVsZW1lbnQgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bMF07XG4gICAgfVxuICB9XG59XG4iXX0=